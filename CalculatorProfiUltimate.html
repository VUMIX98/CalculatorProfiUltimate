<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CalculatorProfiUltimate</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #00dbde, #fc00ff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .subtitle {
            color: #b0b0d0;
            font-size: 1.1rem;
        }
        
        .main-app {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .calculator-container, .converter-container {
            flex: 1;
            min-width: 300px;
            background: rgba(255, 255, 255, 0.07);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            min-height: 600px;
        }
        
        h2 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: #64b5f6;
            border-bottom: 2px solid rgba(100, 181, 246, 0.3);
            padding-bottom: 8px;
        }
        
        .calc-type-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .calc-type-btn {
            padding: 10px 15px;
            background: rgba(100, 181, 246, 0.1);
            border: 1px solid rgba(100, 181, 246, 0.3);
            color: #64b5f6;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .calc-type-btn.active {
            background: rgba(100, 181, 246, 0.3);
            border-color: #64b5f6;
            box-shadow: 0 0 10px rgba(100, 181, 246, 0.5);
        }
        
        .calc-type-btn:hover {
            background: rgba(100, 181, 246, 0.2);
        }
        
        .calculator-display {
            width: 100%;
            min-height: 80px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            margin-bottom: 15px;
            padding: 15px;
            font-size: 2rem;
            text-align: right;
            overflow-x: auto;
            overflow-y: hidden;
            white-space: nowrap;
            border: 1px solid rgba(255, 255, 255, 0.1);
            word-wrap: break-word;
            word-break: break-all;
        }
        
        .calculator-display.format-number {
            font-feature-settings: "tnum";
        }
        
        .calculator-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }
        
        .calc-btn {
            height: 60px;
            background: rgba(255, 255, 255, 0.08);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .calc-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }
        
        .calc-btn.operator {
            background: rgba(255, 152, 0, 0.2);
            color: #ff9800;
        }
        
        .calc-btn.equals {
            background: rgba(76, 175, 80, 0.2);
            color: #4caf50;
            grid-column: span 2;
        }
        
        .calc-btn.clear {
            background: rgba(244, 67, 54, 0.2);
            color: #f44336;
        }
        
        .converter-unit-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .converter-input {
            flex: 1;
            min-width: 200px;
            padding: 12px 15px;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: white;
            font-size: 1.1rem;
        }
        
        .converter-select {
            padding: 12px 15px;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            min-width: 150px;
        }
        
        .converter-result {
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            font-size: 1.1rem;
            text-align: center;
            border: 1px solid rgba(100, 181, 246, 0.3);
            color: #64b5f6;
            min-height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            word-wrap: break-word;
            overflow-wrap: break-word;
            white-space: normal;
            line-height: 1.4;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .converter-category {
            margin-bottom: 20px;
        }
        
        .converter-category-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
            max-height: 150px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .converter-category-selector::-webkit-scrollbar {
            width: 8px;
        }
        
        .converter-category-selector::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }
        
        .converter-category-selector::-webkit-scrollbar-thumb {
            background: rgba(100, 181, 246, 0.5);
            border-radius: 4px;
        }
        
        .category-btn {
            padding: 8px 12px;
            background: rgba(156, 39, 176, 0.1);
            border: 1px solid rgba(156, 39, 176, 0.3);
            color: #9c27b0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        .category-btn.active {
            background: rgba(156, 39, 176, 0.3);
            border-color: #9c27b0;
            box-shadow: 0 0 8px rgba(156, 39, 176, 0.5);
        }
        
        .category-btn:hover {
            background: rgba(156, 39, 176, 0.2);
        }
        
        .hidden {
            display: none;
        }
        
        .calc-section {
            display: none;
        }
        
        .calc-section.active {
            display: block;
        }
        
        .converter-category-content {
            display: none;
        }
        
        .converter-category-content.active {
            display: block;
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            color: #888;
            font-size: 0.9rem;
        }
        
        .bmi-age-input {
            margin-top: 10px;
        }
        
        .division-symbol {
            font-size: 1.4rem;
            position: relative;
        }
        
        .division-symbol::before {
            content: "÷";
        }
        
        .fraction-input {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .fraction-part {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .fraction-line {
            width: 100%;
            height: 2px;
            background: white;
            margin: 5px 0;
        }
        
        .fraction-btn {
            padding: 8px 12px;
            background: rgba(255, 152, 0, 0.2);
            border: 1px solid rgba(255, 152, 0, 0.5);
            color: #ff9800;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        
        @media (max-width: 768px) {
            .main-app {
                flex-direction: column;
            }
            
            .calculator-container, .converter-container {
                width: 100%;
            }
            
            .calculator-display {
                font-size: 1.5rem;
                min-height: 70px;
            }
            
            .calc-btn {
                height: 50px;
                font-size: 1rem;
            }
            
            .converter-result {
                font-size: 1rem;
                padding: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>CalculatorProfiUltimate</h1>
            <p class="subtitle">Профессиональный калькулятор и конвертер единиц измерения</p>
        </header>
        
        <div class="main-app">
            <div class="calculator-container">
                <h2>Калькулятор</h2>
                
                <div class="calc-type-selector">
                    <button class="calc-type-btn active" data-type="simple">Простой</button>
                    <button class="calc-type-btn" data-type="engineering">Инженерный</button>
                    <button class="calc-type-btn" data-type="fraction">Дробный</button>
                    <button class="calc-type-btn" data-type="graph">Графики</button>
                    <button class="calc-type-btn" data-type="programmer">Программист</button>
                    <button class="calc-type-btn" data-type="date">Даты</button>
                </div>
                
                <div id="calc-simple" class="calc-section active">
                    <div class="calculator-display format-number" id="display">0</div>
                    <div class="calculator-buttons">
                        <button class="calc-btn clear" onclick="clearDisplay()">C</button>
                        <button class="calc-btn" onclick="backspace()">⌫</button>
                        <button class="calc-btn operator" onclick="appendToDisplay('%')">%</button>
                        <button class="calc-btn operator division-symbol" onclick="appendToDisplay('/')"></button>
                        
                        <button class="calc-btn" onclick="appendToDisplay('7')">7</button>
                        <button class="calc-btn" onclick="appendToDisplay('8')">8</button>
                        <button class="calc-btn" onclick="appendToDisplay('9')">9</button>
                        <button class="calc-btn operator" onclick="appendToDisplay('*')">×</button>
                        
                        <button class="calc-btn" onclick="appendToDisplay('4')">4</button>
                        <button class="calc-btn" onclick="appendToDisplay('5')">5</button>
                        <button class="calc-btn" onclick="appendToDisplay('6')">6</button>
                        <button class="calc-btn operator" onclick="appendToDisplay('-')">-</button>
                        
                        <button class="calc-btn" onclick="appendToDisplay('1')">1</button>
                        <button class="calc-btn" onclick="appendToDisplay('2')">2</button>
                        <button class="calc-btn" onclick="appendToDisplay('3')">3</button>
                        <button class="calc-btn operator" onclick="appendToDisplay('+')">+</button>
                        
                        <button class="calc-btn" onclick="appendToDisplay('0')">0</button>
                        <button class="calc-btn" onclick="appendToDisplay('.')">,</button>
                        <button class="calc-btn equals" onclick="calculate()">=</button>
                    </div>
                </div>
                
                <div id="calc-engineering" class="calc-section">
                    <div class="calculator-display format-number" id="display-eng">0</div>
                    <div class="calculator-buttons">
                        <button class="calc-btn clear" onclick="clearEngDisplay()">C</button>
                        <button class="calc-btn" onclick="backspaceEng()">⌫</button>
                        <button class="calc-btn operator" onclick="appendToEngDisplay('(')">(</button>
                        <button class="calc-btn operator" onclick="appendToEngDisplay(')')">)</button>
                        
                        <button class="calc-btn operator" onclick="appendToEngDisplay('sin(')">sin</button>
                        <button class="calc-btn operator" onclick="appendToEngDisplay('cos(')">cos</button>
                        <button class="calc-btn operator" onclick="appendToEngDisplay('tan(')">tan</button>
                        <button class="calc-btn operator" onclick="appendToEngDisplay('log(')">log</button>
                        
                        <button class="calc-btn operator" onclick="appendToEngDisplay('ln(')">ln</button>
                        <button class="calc-btn operator" onclick="appendToEngDisplay('sqrt(')">√</button>
                        <button class="calc-btn operator" onclick="appendToEngDisplay('^')">^</button>
                        <button class="calc-btn operator" onclick="appendToEngDisplay('pi')">π</button>
                        
                        <button class="calc-btn" onclick="appendToEngDisplay('7')">7</button>
                        <button class="calc-btn" onclick="appendToEngDisplay('8')">8</button>
                        <button class="calc-btn" onclick="appendToEngDisplay('9')">9</button>
                        <button class="calc-btn operator division-symbol" onclick="appendToEngDisplay('/')"></button>
                        
                        <button class="calc-btn" onclick="appendToEngDisplay('4')">4</button>
                        <button class="calc-btn" onclick="appendToEngDisplay('5')">5</button>
                        <button class="calc-btn" onclick="appendToEngDisplay('6')">6</button>
                        <button class="calc-btn operator" onclick="appendToEngDisplay('*')">×</button>
                        
                        <button class="calc-btn" onclick="appendToEngDisplay('1')">1</button>
                        <button class="calc-btn" onclick="appendToEngDisplay('2')">2</button>
                        <button class="calc-btn" onclick="appendToEngDisplay('3')">3</button>
                        <button class="calc-btn operator" onclick="appendToEngDisplay('-')">-</button>
                        
                        <button class="calc-btn" onclick="appendToEngDisplay('0')">0</button>
                        <button class="calc-btn" onclick="appendToEngDisplay('.')">,</button>
                        <button class="calc-btn equals" onclick="calculateEng()">=</button>
                        <button class="calc-btn operator" onclick="appendToEngDisplay('+')">+</button>
                    </div>
                </div>
                
                <div id="calc-fraction" class="calc-section">
                    <h3 style="margin-bottom: 15px; color: #ff9800;">Дробный калькулятор</h3>
                    <div class="calculator-display format-number" id="display-frac">0</div>
                    <div class="fraction-input">
                        <div class="fraction-part">
                            <input type="number" id="frac-num1" class="converter-input" placeholder="Числитель" value="1">
                            <div class="fraction-line"></div>
                            <input type="number" id="frac-den1" class="converter-input" placeholder="Знаменатель" value="2">
                        </div>
                        <select id="frac-operation" class="converter-select">
                            <option value="+">+</option>
                            <option value="-">-</option>
                            <option value="*">×</option>
                            <option value="/">÷</option>
                        </select>
                        <div class="fraction-part">
                            <input type="number" id="frac-num2" class="converter-input" placeholder="Числитель" value="1">
                            <div class="fraction-line"></div>
                            <input type="number" id="frac-den2" class="converter-input" placeholder="Знаменатель" value="4">
                        </div>
                        <button class="calc-btn equals" onclick="calculateFraction()" style="min-width: 100px;">=</button>
                    </div>
                    <div class="converter-result" id="fraction-result">Результат: 3/4</div>
                    <div style="margin-top: 20px;">
                        <button class="fraction-btn" onclick="simplifyFraction()">Упростить дробь</button>
                        <button class="fraction-btn" onclick="convertToDecimal()">В десятичную</button>
                        <button class="fraction-btn" onclick="convertToPercentage()">В проценты</button>
                    </div>
                </div>
                
                <div id="calc-programmer" class="calc-section">
                    <div class="calculator-display format-number" id="display-prog">0</div>
                    <div style="margin-bottom: 15px;">
                        <input type="text" id="number-system-input" class="converter-input" placeholder="Система счисления (2-36)" value="10">
                        <div style="margin-top: 5px; display: flex; flex-wrap: wrap; gap: 5px;">
                            <button class="calc-btn" onclick="setNumberSystem(2)" style="padding: 5px 10px; font-size: 0.9rem;">2</button>
                            <button class="calc-btn" onclick="setNumberSystem(8)" style="padding: 5px 10px; font-size: 0.9rem;">8</button>
                            <button class="calc-btn" onclick="setNumberSystem(10)" style="padding: 5px 10px; font-size: 0.9rem;">10</button>
                            <button class="calc-btn" onclick="setNumberSystem(16)" style="padding: 5px 10px; font-size: 0.9rem;">16</button>
                            <button class="calc-btn" onclick="setNumberSystem(32)" style="padding: 5px 10px; font-size: 0.9rem;">32</button>
                            <button class="calc-btn" onclick="setNumberSystem(36)" style="padding: 5px 10px; font-size: 0.9rem;">36</button>
                        </div>
                    </div>
                    <div class="calculator-buttons">
                        <button class="calc-btn clear" onclick="clearProgDisplay()">C</button>
                        <button class="calc-btn" onclick="backspaceProg()">⌫</button>
                        <button class="calc-btn operator" onclick="appendToProgDisplay('A')">A</button>
                        <button class="calc-btn operator" onclick="appendToProgDisplay('B')">B</button>
                        
                        <button class="calc-btn operator" onclick="appendToProgDisplay('C')">C</button>
                        <button class="calc-btn operator" onclick="appendToProgDisplay('D')">D</button>
                        <button class="calc-btn operator" onclick="appendToProgDisplay('E')">E</button>
                        <button class="calc-btn operator" onclick="appendToProgDisplay('F')">F</button>
                        
                        <button class="calc-btn operator" onclick="appendToProgDisplay('<<')">&lt;&lt;</button>
                        <button class="calc-btn operator" onclick="appendToProgDisplay('>>')">&gt;&gt;</button>
                        <button class="calc-btn operator" onclick="appendToProgDisplay('&')">AND</button>
                        <button class="calc-btn operator" onclick="appendToProgDisplay('|')">OR</button>
                        
                        <button class="calc-btn" onclick="appendToProgDisplay('7')">7</button>
                        <button class="calc-btn" onclick="appendToProgDisplay('8')">8</button>
                        <button class="calc-btn" onclick="appendToProgDisplay('9')">9</button>
                        <button class="calc-btn operator" onclick="appendToProgDisplay('^')">XOR</button>
                        
                        <button class="calc-btn" onclick="appendToProgDisplay('4')">4</button>
                        <button class="calc-btn" onclick="appendToProgDisplay('5')">5</button>
                        <button class="calc-btn" onclick="appendToProgDisplay('6')">6</button>
                        <button class="calc-btn operator" onclick="appendToProgDisplay('~')">NOT</button>
                        
                        <button class="calc-btn" onclick="appendToProgDisplay('1')">1</button>
                        <button class="calc-btn" onclick="appendToProgDisplay('2')">2</button>
                        <button class="calc-btn" onclick="appendToProgDisplay('3')">3</button>
                        <button class="calc-btn operator" onclick="appendToProgDisplay('+')">+</button>
                        
                        <button class="calc-btn" onclick="appendToProgDisplay('0')">0</button>
                        <button class="calc-btn equals" onclick="calculateProg()">=</button>
                        <button class="calc-btn operator" onclick="appendToProgDisplay('-')">-</button>
                        <button class="calc-btn operator" onclick="appendToProgDisplay('*')">×</button>
                    </div>
                </div>
                
                <div id="calc-date" class="calc-section">
                    <h3 style="margin-bottom: 15px; color: #ff9800;">Калькулятор дат</h3>
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px;">Дата 1:</label>
                        <input type="date" id="date1" class="converter-input" value="2023-01-01">
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px;">Дата 2:</label>
                        <input type="date" id="date2" class="converter-input" value="2023-12-31">
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px;">Операция:</label>
                        <select id="date-operation" class="converter-select">
                            <option value="difference">Разница между датами</option>
                            <option value="add">Добавить дни</option>
                            <option value="subtract">Вычесть дни</option>
                            <option value="dayofweek">День недели</option>
                        </select>
                    </div>
                    <div id="date-days-container" style="margin-bottom: 15px; display: none;">
                        <label style="display: block; margin-bottom: 5px;">Количество дней:</label>
                        <input type="number" id="date-days" class="converter-input" placeholder="Количество дней" value="0">
                    </div>
                    <button class="calc-btn equals" onclick="calculateDate()" style="width: 100%;">Вычислить</button>
                    <div class="converter-result" id="date-result"></div>
                </div>
                
                <div id="calc-graph" class="calc-section">
                    <h3 style="margin-bottom: 15px; color: #ff9800;">Построитель графиков</h3>
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px;">Функция:</label>
                        <input type="text" id="graph-function" class="converter-input" placeholder="Например: x^2 + 2*x + 1" value="x^2">
                    </div>
                    <div style="margin-bottom: 15px; display: flex; gap: 10px;">
                        <div style="flex: 1;">
                            <label style="display: block; margin-bottom: 5px;">Мин X:</label>
                            <input type="number" id="graph-min" class="converter-input" placeholder="Мин X" value="-10">
                        </div>
                        <div style="flex: 1;">
                            <label style="display: block; margin-bottom: 5px;">Макс X:</label>
                            <input type="number" id="graph-max" class="converter-input" placeholder="Макс X" value="10">
                        </div>
                    </div>
                    <button class="calc-btn equals" onclick="plotGraph()" style="width: 100%;">Построить график</button>
                    <div id="graph-container" style="margin-top: 20px; height: 250px; background: rgba(0,0,0,0.2); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #888; padding: 20px;">
                        <div style="text-align: center;">
                            <canvas id="graph-canvas" width="400" height="200" style="display: none;"></canvas>
                            <p>Введите функцию и нажмите "Построить график"</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="converter-container">
                <h2>Конвертер единиц</h2>
                
                <div class="converter-category">
                    <div class="converter-category-selector">
                        <button class="category-btn active" data-category="length">Длина</button>
                        <button class="category-btn" data-category="mass">Масса</button>
                        <button class="category-btn" data-category="temperature">Температура</button>
                        <button class="category-btn" data-category="area">Площадь</button>
                        <button class="category-btn" data-category="volume">Объем</button>
                        <button class="category-btn" data-category="time">Время</button>
                        <button class="category-btn" data-category="speed">Скорость</button>
                        <button class="category-btn" data-category="data">Данные</button>
                        <button class="category-btn" data-category="energy">Энергия</button>
                        <button class="category-btn" data-category="pressure">Давление</button>
                        <button class="category-btn" data-category="angle">Угол</button>
                        <button class="category-btn" data-category="discount">Скидка</button>
                        <button class="category-btn" data-category="numeral">Системы счисления</button>
                        <button class="category-btn" data-category="bmi">ИМТ</button>
                    </div>
                    
                    <div id="converter-length" class="converter-category-content active">
                        <div class="converter-unit-selector">
                            <input type="number" id="length-input" class="converter-input" value="1" step="any">
                            <select id="length-from" class="converter-select">
                                <option value="m">Метры (м)</option>
                                <option value="km">Километры (км)</option>
                                <option value="cm">Сантиметры (см)</option>
                                <option value="mm">Миллиметры (мм)</option>
                                <option value="mile">Мили</option>
                                <option value="yard">Ярды</option>
                                <option value="foot">Футы</option>
                                <option value="inch">Дюймы</option>
                            </select>
                            <span>→</span>
                            <select id="length-to" class="converter-select">
                                <option value="m">Метры (м)</option>
                                <option value="km">Километры (км)</option>
                                <option value="cm">Сантиметры (см)</option>
                                <option value="mm">Миллиметры (мм)</option>
                                <option value="mile">Мили</option>
                                <option value="yard">Ярды</option>
                                <option value="foot">Футы</option>
                                <option value="inch">Дюймы</option>
                            </select>
                        </div>
                        <div class="converter-result" id="length-result">1 метр = 100 сантиметров</div>
                    </div>
                    
                    <div id="converter-mass" class="converter-category-content">
                        <div class="converter-unit-selector">
                            <input type="number" id="mass-input" class="converter-input" value="1" step="any">
                            <select id="mass-from" class="converter-select">
                                <option value="kg">Килограммы (кг)</option>
                                <option value="g">Граммы (г)</option>
                                <option value="mg">Миллиграммы (мг)</option>
                                <option value="ton">Тонны</option>
                                <option value="pound">Фунты</option>
                                <option value="ounce">Унции</option>
                            </select>
                            <span>→</span>
                            <select id="mass-to" class="converter-select">
                                <option value="kg">Килограммы (кг)</option>
                                <option value="g">Граммы (г)</option>
                                <option value="mg">Миллиграммы (мг)</option>
                                <option value="ton">Тонны</option>
                                <option value="pound">Фунты</option>
                                <option value="ounce">Унции</option>
                            </select>
                        </div>
                        <div class="converter-result" id="mass-result">1 килограмм = 1000 грамм</div>
                    </div>
                    
                    <div id="converter-temperature" class="converter-category-content">
                        <div class="converter-unit-selector">
                            <input type="number" id="temperature-input" class="converter-input" value="0" step="any">
                            <select id="temperature-from" class="converter-select">
                                <option value="celsius">Цельсий (°C)</option>
                                <option value="fahrenheit">Фаренгейт (°F)</option>
                                <option value="kelvin">Кельвин (K)</option>
                            </select>
                            <span>→</span>
                            <select id="temperature-to" class="converter-select">
                                <option value="celsius">Цельсий (°C)</option>
                                <option value="fahrenheit">Фаренгейт (°F)</option>
                                <option value="kelvin">Кельвин (K)</option>
                            </select>
                        </div>
                        <div class="converter-result" id="temperature-result">0°C = 32°F</div>
                    </div>
                    
                    <div id="converter-area" class="converter-category-content">
                        <div class="converter-unit-selector">
                            <input type="number" id="area-input" class="converter-input" value="1" step="any">
                            <select id="area-from" class="converter-select">
                                <option value="m2">Квадратные метры (м²)</option>
                                <option value="km2">Квадратные километры (км²)</option>
                                <option value="ha">Гектары (га)</option>
                                <option value="acre">Акры</option>
                                <option value="sq_foot">Квадратные футы</option>
                            </select>
                            <span>→</span>
                            <select id="area-to" class="converter-select">
                                <option value="m2">Квадратные метры (м²)</option>
                                <option value="km2">Квадратные километры (км²)</option>
                                <option value="ha">Гектары (га)</option>
                                <option value="acre">Акры</option>
                                <option value="sq_foot">Квадратные футы</option>
                            </select>
                        </div>
                        <div class="converter-result" id="area-result">1 м² = 10000 см²</div>
                    </div>
                    
                    <div id="converter-volume" class="converter-category-content">
                        <div class="converter-unit-selector">
                            <input type="number" id="volume-input" class="converter-input" value="1" step="any">
                            <select id="volume-from" class="converter-select">
                                <option value="m3">Кубические метры (м³)</option>
                                <option value="l">Литры (л)</option>
                                <option value="ml">Миллилитры (мл)</option>
                                <option value="gal">Галлоны</option>
                                <option value="cu_foot">Кубические футы</option>
                            </select>
                            <span>→</span>
                            <select id="volume-to" class="converter-select">
                                <option value="m3">Кубические метры (м³)</option>
                                <option value="l">Литры (л)</option>
                                <option value="ml">Миллилитры (мл)</option>
                                <option value="gal">Галлоны</option>
                                <option value="cu_foot">Кубические футы</option>
                            </select>
                        </div>
                        <div class="converter-result" id="volume-result">1 литр = 1000 мл</div>
                    </div>
                    
                    <div id="converter-time" class="converter-category-content">
                        <div class="converter-unit-selector">
                            <input type="number" id="time-input" class="converter-input" value="1" step="any">
                            <select id="time-from" class="converter-select">
                                <option value="second">Секунды</option>
                                <option value="minute">Минуты</option>
                                <option value="hour">Часы</option>
                                <option value="day">Дни</option>
                                <option value="week">Недели</option>
                                <option value="month">Месяцы (30 дней)</option>
                                <option value="year">Годы (365 дней)</option>
                            </select>
                            <span>→</span>
                            <select id="time-to" class="converter-select">
                                <option value="second">Секунды</option>
                                <option value="minute">Минуты</option>
                                <option value="hour">Часы</option>
                                <option value="day">Дни</option>
                                <option value="week">Недели</option>
                                <option value="month">Месяцы (30 дней)</option>
                                <option value="year">Годы (365 дней)</option>
                            </select>
                        </div>
                        <div class="converter-result" id="time-result">1 час = 60 минут</div>
                    </div>
                    
                    <div id="converter-speed" class="converter-category-content">
                        <div class="converter-unit-selector">
                            <input type="number" id="speed-input" class="converter-input" value="1" step="any">
                            <select id="speed-from" class="converter-select">
                                <option value="mps">Метры в секунду (м/с)</option>
                                <option value="kmph">Километры в час (км/ч)</option>
                                <option value="mph">Мили в час (миль/ч)</option>
                                <option value="knot">Узлы</option>
                            </select>
                            <span>→</span>
                            <select id="speed-to" class="converter-select">
                                <option value="mps">Метры в секунду (м/с)</option>
                                <option value="kmph">Километры в час (км/ч)</option>
                                <option value="mph">Мили в час (миль/ч)</option>
                                <option value="knot">Узлы</option>
                            </select>
                        </div>
                        <div class="converter-result" id="speed-result">1 м/с = 3.6 км/ч</div>
                    </div>
                    
                    <div id="converter-data" class="converter-category-content">
                        <div class="converter-unit-selector">
                            <input type="number" id="data-input" class="converter-input" value="1" step="any">
                            <select id="data-from" class="converter-select">
                                <option value="bit">Биты (bit)</option>
                                <option value="byte">Байты (B)</option>
                                <option value="kb">Килобайты (KB)</option>
                                <option value="mb">Мегабайты (MB)</option>
                                <option value="gb">Гигабайты (GB)</option>
                                <option value="tb">Терабайты (TB)</option>
                                <option value="pb">Петабайты (PB)</option>
                            </select>
                            <span>→</span>
                            <select id="data-to" class="converter-select">
                                <option value="bit">Биты (bit)</option>
                                <option value="byte">Байты (B)</option>
                                <option value="kb">Килобайты (KB)</option>
                                <option value="mb">Мегабайты (MB)</option>
                                <option value="gb">Гигабайты (GB)</option>
                                <option value="tb">Терабайты (TB)</option>
                                <option value="pb">Петабайты (PB)</option>
                            </select>
                        </div>
                        <div class="converter-result" id="data-result">1 байт = 8 бит</div>
                    </div>
                    
                    <div id="converter-energy" class="converter-category-content">
                        <div class="converter-unit-selector">
                            <input type="number" id="energy-input" class="converter-input" value="1" step="any">
                            <select id="energy-from" class="converter-select">
                                <option value="joule">Джоули (Дж)</option>
                                <option value="kj">Килоджоули (кДж)</option>
                                <option value="cal">Калории (кал)</option>
                                <option value="food_cal">Пищевые калории (ккал)</option>
                                <option value="kwh">Киловатт-часы (кВт·ч)</option>
                            </select>
                            <span>→</span>
                            <select id="energy-to" class="converter-select">
                                <option value="joule">Джоули (Дж)</option>
                                <option value="kj">Килоджоули (кДж)</option>
                                <option value="cal">Калории (кал)</option>
                                <option value="food_cal">Пищевые калории (ккал)</option>
                                <option value="kwh">Киловатт-часы (кВт·ч)</option>
                            </select>
                        </div>
                        <div class="converter-result" id="energy-result">1 Дж = 0.000239 ккал</div>
                    </div>
                    
                    <div id="converter-angle" class="converter-category-content">
                        <div class="converter-unit-selector">
                            <input type="number" id="angle-input" class="converter-input" value="90" step="any">
                            <select id="angle-from" class="converter-select">
                                <option value="degree">Градусы (°)</option>
                                <option value="radian">Радианы (rad)</option>
                                <option value="grad">Грады (grad)</option>
                            </select>
                            <span>→</span>
                            <select id="angle-to" class="converter-select">
                                <option value="degree">Градусы (°)</option>
                                <option value="radian">Радианы (rad)</option>
                                <option value="grad">Грады (grad)</option>
                            </select>
                        </div>
                        <div class="converter-result" id="angle-result">90° = 1.5708 радиан</div>
                    </div>
                    
                    <div id="converter-pressure" class="converter-category-content">
                        <div class="converter-unit-selector">
                            <input type="number" id="pressure-input" class="converter-input" value="1" step="any">
                            <select id="pressure-from" class="converter-select">
                                <option value="pa">Паскали (Pa)</option>
                                <option value="kpa">Килопаскали (kPa)</option>
                                <option value="bar">Бары (bar)</option>
                                <option value="atm">Атмосферы (atm)</option>
                                <option value="psi">PSI (psi)</option>
                            </select>
                            <span>→</span>
                            <select id="pressure-to" class="converter-select">
                                <option value="pa">Паскали (Pa)</option>
                                <option value="kpa">Килопаскали (kPa)</option>
                                <option value="bar">Бары (bar)</option>
                                <option value="atm">Атмосферы (atm)</option>
                                <option value="psi">PSI (psi)</option>
                            </select>
                        </div>
                        <div class="converter-result" id="pressure-result">1 бар = 100000 Паскалей</div>
                    </div>
                    
                    <div id="converter-discount" class="converter-category-content">
                        <div style="margin-bottom: 15px;">
                            <input type="number" id="discount-price" class="converter-input" placeholder="Оригинальная цена" value="100">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <input type="number" id="discount-percent" class="converter-input" placeholder="Скидка в %" value="20">
                        </div>
                        <button class="calc-btn equals" onclick="calculateDiscount()" style="width: 100%; margin-bottom: 15px;">Рассчитать</button>
                        <div class="converter-result" id="discount-result">Цена со скидкой: 80</div>
                    </div>
                    
                    <div id="converter-bmi" class="converter-category-content">
                        <div style="margin-bottom: 15px;">
                            <input type="number" id="bmi-height" class="converter-input" placeholder="Рост (см)" value="175">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <input type="number" id="bmi-weight" class="converter-input" placeholder="Вес (кг)" value="70">
                        </div>
                        <div style="margin-bottom: 15px;" class="bmi-age-input">
                            <input type="number" id="bmi-age" class="converter-input" placeholder="Возраст (лет)" value="30" min="1" max="150">
                        </div>
                        <button class="calc-btn equals" onclick="calculateBMI()" style="width: 100%; margin-bottom: 15px;">Рассчитать ИМТ</button>
                        <div class="converter-result" id="bmi-result">Ваш ИМТ: 22,86 (Нормальный вес)</div>
                    </div>
                    
                    <div id="converter-numeral" class="converter-category-content">
                        <div class="converter-unit-selector">
                            <input type="text" id="numeral-input" class="converter-input" value="10">
                            <select id="numeral-from" class="converter-select">
                                <option value="2">Двоичная (2)</option>
                                <option value="8">Восьмеричная (8)</option>
                                <option value="10" selected>Десятичная (10)</option>
                                <option value="16">Шестнадцатеричная (16)</option>
                                <option value="32">Тридцатидвухтеричная (32)</option>
                                <option value="36">Тридцатишеститеричная (36)</option>
                            </select>
                            <span>→</span>
                            <select id="numeral-to" class="converter-select">
                                <option value="2">Двоичная (2)</option>
                                <option value="8">Восьмеричная (8)</option>
                                <option value="10" selected>Десятичная (10)</option>
                                <option value="16">Шестнадцатеричная (16)</option>
                                <option value="32">Тридцатидвухтеричная (32)</option>
                                <option value="36">Тридцатишеститеричная (36)</option>
                            </select>
                        </div>
                        <div class="converter-result" id="numeral-result">10 (dec) = 1010 (bin)</div>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>CalculatorProfiUltimate - Профессиональный калькулятор и конвертер единиц</p>
            <p style="font-size: 0.8rem; margin-top: 5px;">Поддержка клавиатуры: цифры 0-9, Enter, Backspace, Escape</p>
            <p style="font-size: 0.8rem; margin-top: 5px;">GitHub - @VUMIX98</p>
        </footer>
    </div>

    <script>
        // Основные переменные
        let currentCalcType = 'simple';
        let currentConverterCategory = 'length';
        let currentNumberSystem = 10;
        
        // ============ ПОЛНАЯ ПОДДЕРЖКА КЛАВИАТУРЫ ============
        document.addEventListener('keydown', function(event) {
            // Если фокус в поле ввода, разрешаем стандартное поведение
            if (event.target.tagName === 'INPUT' || event.target.tagName === 'SELECT' || event.target.tagName === 'TEXTAREA') {
                // Но обрабатываем Enter для вычислений
                if (event.key === 'Enter') {
                    event.preventDefault();
                    handleKeyPress('Enter');
                }
                return;
            }
            
            handleKeyPress(event.key, event);
        });
        
        function handleKeyPress(key, event = null) {
            // Цифры 0-9
            if (key >= '0' && key <= '9') {
                handleKeyboardNumber(key);
            }
            
            // Буквы A-F для программистского калькулятора
            if (key >= 'a' && key <= 'f') key = key.toUpperCase();
            if (key >= 'A' && key <= 'F' && currentCalcType === 'programmer') {
                handleKeyboardNumber(key);
            }
            
            // Операторы и специальные клавиши
            switch(key.toLowerCase()) {
                case '+':
                    handleKeyboardOperator('+');
                    break;
                case '-':
                    handleKeyboardOperator('-');
                    break;
                case '*':
                case 'x':
                    handleKeyboardOperator('*');
                    break;
                case '/':
                    handleKeyboardOperator('/');
                    break;
                case '.':
                case ',':
                    handleKeyboardNumber('.');
                    break;
                case 'enter':
                case '=':
                    handleKeyboardEquals();
                    if (event) event.preventDefault();
                    break;
                case 'backspace':
                    handleKeyboardBackspace();
                    break;
                case 'escape':
                    handleKeyboardClear();
                    break;
                case '(':
                    if (currentCalcType === 'engineering') {
                        handleKeyboardNumber('(');
                    }
                    break;
                case ')':
                    if (currentCalcType === 'engineering') {
                        handleKeyboardNumber(')');
                    }
                    break;
                case '%':
                    handleKeyboardOperator('%');
                    break;
                case 'c':
                    if (event && event.ctrlKey) {
                        handleKeyboardClear();
                    }
                    break;
            }
        }
        
        function handleKeyboardNumber(number) {
            switch(currentCalcType) {
                case 'simple':
                    appendToDisplay(number);
                    break;
                case 'engineering':
                    appendToEngDisplay(number);
                    break;
                case 'programmer':
                    if ((number >= '0' && number <= '9') || 
                        (number >= 'A' && number <= 'F')) {
                        appendToProgDisplay(number);
                    }
                    break;
            }
        }
        
        function handleKeyboardOperator(operator) {
            switch(currentCalcType) {
                case 'simple':
                    handleOperator(operator);
                    break;
                case 'engineering':
                    appendToEngDisplay(operator);
                    break;
                case 'programmer':
                    // В программистском калькуляторе операторы работают по-другому
                    if (operator === '+' || operator === '-' || operator === '*' || operator === '/') {
                        handleProgOperator(operator);
                    }
                    break;
            }
        }
        
        function handleKeyboardEquals() {
            switch(currentCalcType) {
                case 'simple':
                    calculate();
                    break;
                case 'engineering':
                    calculateEng();
                    break;
                case 'programmer':
                    calculateProg();
                    break;
                case 'fraction':
                    calculateFraction();
                    break;
                case 'date':
                    calculateDate();
                    break;
                case 'graph':
                    plotGraph();
                    break;
            }
        }
        
        function handleKeyboardBackspace() {
            switch(currentCalcType) {
                case 'simple':
                    backspace();
                    break;
                case 'engineering':
                    backspaceEng();
                    break;
                case 'programmer':
                    backspaceProg();
                    break;
            }
        }
        
        function handleKeyboardClear() {
            switch(currentCalcType) {
                case 'simple':
                    clearDisplay();
                    break;
                case 'engineering':
                    clearEngDisplay();
                    break;
                case 'programmer':
                    clearProgDisplay();
                    break;
            }
        }
        
        // ============ ИНИЦИАЛИЗАЦИЯ ============
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            
            // Инициализация конвертеров
            convertLength();
            convertMass();
            convertTemperature();
            convertArea();
            convertVolume();
            convertTime();
            convertSpeed();
            convertData();
            convertEnergy(); // Инициализируем энергию
            convertAngle();
            convertPressure();
            calculateDiscount();
            convertNumeral();
            calculateBMI();
            
            // Инициализация дробного калькулятора
            calculateFraction();
            
            // Фокус на тело документа для поддержки клавиатуры
            document.body.focus();
            document.body.setAttribute('tabindex', '0');
        });
        
        // Настройка обработчиков событий
        function setupEventListeners() {
            // Кнопки выбора типа калькулятора
            document.querySelectorAll('.calc-type-btn').forEach(button => {
                button.addEventListener('click', function() {
                    document.querySelectorAll('.calc-type-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    this.classList.add('active');
                    currentCalcType = this.getAttribute('data-type');
                    
                    document.querySelectorAll('.calc-section').forEach(section => {
                        section.classList.remove('active');
                    });
                    document.getElementById(`calc-${currentCalcType}`).classList.add('active');
                    
                    // Фокус на тело документа для клавиатуры
                    document.body.focus();
                });
            });
            
            // Кнопки выбора категории конвертера
            document.querySelectorAll('.category-btn').forEach(button => {
                button.addEventListener('click', function() {
                    document.querySelectorAll('.category-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    this.classList.add('active');
                    currentConverterCategory = this.getAttribute('data-category');
                    
                    document.querySelectorAll('.converter-category-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(`converter-${currentConverterCategory}`).classList.add('active');
                    
                    updateConverterDisplay();
                });
            });
            
            // Обработчики для конвертеров
            const converters = [
                'length', 'mass', 'temperature', 'area', 'volume', 'time', 
                'speed', 'data', 'energy', 'pressure', 'angle', 'numeral'
            ];
            
            converters.forEach(converter => {
                const input = document.getElementById(`${converter}-input`);
                const fromSelect = document.getElementById(`${converter}-from`);
                const toSelect = document.getElementById(`${converter}-to`);
                
                if (input && fromSelect && toSelect) {
                    input.addEventListener('input', () => {
                        try {
                            eval(`convert${converter.charAt(0).toUpperCase() + converter.slice(1)}()`);
                        } catch(e) {
                            console.log(e);
                        }
                    });
                    fromSelect.addEventListener('change', () => {
                        try {
                            eval(`convert${converter.charAt(0).toUpperCase() + converter.slice(1)}()`);
                        } catch(e) {
                            console.log(e);
                        }
                    });
                    toSelect.addEventListener('change', () => {
                        try {
                            eval(`convert${converter.charAt(0).toUpperCase() + converter.slice(1)}()`);
                        } catch(e) {
                            console.log(e);
                        }
                    });
                }
            });
            
            // Обработчик для калькулятора дат
            const dateOperation = document.getElementById('date-operation');
            if (dateOperation) {
                dateOperation.addEventListener('change', function() {
                    const operation = this.value;
                    const daysContainer = document.getElementById('date-days-container');
                    if (operation === 'add' || operation === 'subtract') {
                        daysContainer.style.display = 'block';
                    } else {
                        daysContainer.style.display = 'none';
                    }
                });
            }
            
            // Обработчик для ввода системы счисления
            const numberSystemInput = document.getElementById('number-system-input');
            if (numberSystemInput) {
                numberSystemInput.addEventListener('change', function() {
                    const base = parseInt(this.value);
                    if (base >= 2 && base <= 36) {
                        currentNumberSystem = base;
                        clearProgDisplay();
                    }
                });
            }
            
            // Обработчики для энергии
            const energyInput = document.getElementById('energy-input');
            const energyFrom = document.getElementById('energy-from');
            const energyTo = document.getElementById('energy-to');
            
            if (energyInput && energyFrom && energyTo) {
                energyInput.addEventListener('input', convertEnergy);
                energyFrom.addEventListener('change', convertEnergy);
                energyTo.addEventListener('change', convertEnergy);
            }
        }
        
        // ============ ПРОСТОЙ КАЛЬКУЛЯТОР - ПОЛНОСТЬЮ ИСПРАВЛЕН ============
        let displayValue = '0';
        let firstOperand = null;
        let waitingForSecondOperand = false;
        let operator = null;
        let shouldResetDisplay = false;
        
        // Функция для форматирования чисел
        function formatNumber(numStr) {
            // Заменяем точку на запятую
            numStr = numStr.replace(/\./g, ',');
            
            if (!numStr.includes(',')) {
                return numStr.replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
            } else {
                const parts = numStr.split(',');
                parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
                return parts.join(',');
            }
        }
        
        function removeTrailingZeros(numStr) {
            const tempStr = numStr.replace(/,/g, '.');
            let result = tempStr;
            
            if (result.includes('.')) {
                result = result.replace(/(\.\d*?[1-9])0+$/, "$1");
                result = result.replace(/\.$/, '');
            }
            
            return result.replace(/\./g, ',');
        }
        
        function updateDisplay() {
            const display = document.getElementById('display');
            let formattedValue = displayValue;
            
            formattedValue = removeTrailingZeros(formattedValue);
            formattedValue = formatNumber(formattedValue);
            
            display.textContent = formattedValue;
            
            if (formattedValue.length > 12) {
                display.style.fontSize = `${Math.max(1.5, 2.5 - (formattedValue.length - 12) * 0.1)}rem`;
            } else {
                display.style.fontSize = '2rem';
            }
        }
        
        function clearDisplay() {
            displayValue = '0';
            firstOperand = null;
            waitingForSecondOperand = false;
            operator = null;
            shouldResetDisplay = false;
            updateDisplay();
        }
        
        function appendToDisplay(number) {
            if (number === ',') {
                number = '.';
            }
            
            if (shouldResetDisplay) {
                displayValue = '0';
                shouldResetDisplay = false;
            }
            
            if (displayValue === '0' && number !== '.') {
                displayValue = number;
            } else if (number === '.' && displayValue.includes('.')) {
                return;
            } else {
                displayValue += number;
            }
            
            updateDisplay();
        }
        
        function backspace() {
            if (displayValue.length > 1) {
                displayValue = displayValue.slice(0, -1);
            } else {
                displayValue = '0';
            }
            updateDisplay();
        }
        
        function handleOperator(nextOperator) {
            const inputValue = parseFloat(displayValue.replace(/ /g, '').replace(/,/g, '.'));
            
            if (firstOperand === null && !isNaN(inputValue)) {
                firstOperand = inputValue;
            } else if (operator) {
                const result = performCalculation();
                displayValue = `${result}`;
                firstOperand = result;
            }
            
            waitingForSecondOperand = true;
            operator = nextOperator;
            shouldResetDisplay = true;
        }
        
        function performCalculation() {
            const inputValue = parseFloat(displayValue.replace(/ /g, '').replace(/,/g, '.'));
            
            if (operator === '+') return firstOperand + inputValue;
            if (operator === '-') return firstOperand - inputValue;
            if (operator === '*') return firstOperand * inputValue;
            if (operator === '/') {
                if (inputValue === 0) {
                    return 'Ошибка';
                }
                return firstOperand / inputValue;
            }
            if (operator === '%') return firstOperand % inputValue;
            return inputValue;
        }
        
        function calculate() {
            if (operator && firstOperand !== null) {
                const result = performCalculation();
                
                if (result === 'Ошибка') {
                    displayValue = 'Ошибка';
                } else {
                    displayValue = `${result}`;
                }
                
                operator = null;
                firstOperand = null;
                waitingForSecondOperand = false;
                shouldResetDisplay = true;
                updateDisplay();
            }
        }
        
        // Обновляем обработчики кнопок операторов
        document.querySelectorAll('.calc-btn.operator').forEach(btn => {
            if (btn.textContent === '+') {
                btn.onclick = () => handleOperator('+');
            } else if (btn.textContent === '-') {
                btn.onclick = () => handleOperator('-');
            } else if (btn.textContent === '×') {
                btn.onclick = () => handleOperator('*');
            } else if (btn.classList.contains('division-symbol')) {
                btn.onclick = () => handleOperator('/');
            } else if (btn.textContent === '%') {
                btn.onclick = () => handleOperator('%');
            }
        });
        
        // ============ ИНЖЕНЕРНЫЙ КАЛЬКУЛЯТОР ============
        let engDisplayValue = '0';
        
        function updateEngDisplay() {
            const display = document.getElementById('display-eng');
            let formattedValue = engDisplayValue;
            
            // Форматируем только если это не выражение
            if (!engDisplayValue.includes('sin(') && !engDisplayValue.includes('cos(') && 
                !engDisplayValue.includes('tan(') && !engDisplayValue.includes('log(') &&
                !engDisplayValue.includes('ln(') && !engDisplayValue.includes('sqrt(')) {
                formattedValue = removeTrailingZeros(formattedValue);
                formattedValue = formatNumber(formattedValue);
            }
            
            display.textContent = formattedValue;
            
            if (formattedValue.length > 15) {
                display.style.fontSize = `${Math.max(1.2, 2 - (formattedValue.length - 15) * 0.1)}rem`;
            } else {
                display.style.fontSize = '2rem';
            }
        }
        
        function clearEngDisplay() {
            engDisplayValue = '0';
            updateEngDisplay();
        }
        
        function backspaceEng() {
            if (engDisplayValue.length > 1) {
                engDisplayValue = engDisplayValue.slice(0, -1);
            } else {
                engDisplayValue = '0';
            }
            updateEngDisplay();
        }
        
        function appendToEngDisplay(value) {
            if (value === ',') {
                value = '.';
            }
            
            if (engDisplayValue === '0' && !'()'.includes(value) && value !== '.') {
                engDisplayValue = value;
            } else {
                // Проверяем, можно ли добавить точку
                if (value === '.') {
                    // Находим последнее число в выражении
                    const lastNumberMatch = engDisplayValue.match(/[\d\.]+$/);
                    if (lastNumberMatch && lastNumberMatch[0].includes('.')) {
                        return; // В последнем числе уже есть точка
                    }
                }
                engDisplayValue += value;
            }
            updateEngDisplay();
        }
        
        function calculateEng() {
            try {
                let expression = engDisplayValue
                    .replace(/sin\(/g, 'Math.sin(')
                    .replace(/cos\(/g, 'Math.cos(')
                    .replace(/tan\(/g, 'Math.tan(')
                    .replace(/log\(/g, 'Math.log10(')
                    .replace(/ln\(/g, 'Math.log(')
                    .replace(/sqrt\(/g, 'Math.sqrt(')
                    .replace(/pi/g, 'Math.PI')
                    .replace(/\^/g, '**')
                    .replace(/,/g, '.');
                
                // Проверяем на наличие незакрытых скобок
                const openParen = (expression.match(/\(/g) || []).length;
                const closeParen = (expression.match(/\)/g) || []).length;
                if (openParen > closeParen) {
                    expression += ')'.repeat(openParen - closeParen);
                }
                
                const result = eval(expression);
                
                // Проверяем на ошибки
                if (isNaN(result) || !isFinite(result)) {
                    throw new Error('Invalid result');
                }
                
                engDisplayValue = result.toString();
                updateEngDisplay();
            } catch (error) {
                console.error('Calculation error:', error);
                engDisplayValue = 'Ошибка';
                updateEngDisplay();
            }
        }
        
        // ============ КАЛЬКУЛЯТОР ПРОГРАММИСТА ============
        let progDisplayValue = '0';
        let progFirstOperand = null;
        let progOperator = null;
        let progWaitingForSecondOperand = false;
        
        function updateProgDisplay() {
            const display = document.getElementById('display-prog');
            
            // Проверяем валидность числа для текущей системы счисления
            try {
                // Пробуем преобразовать для проверки
                const decimalValue = parseInt(progDisplayValue, currentNumberSystem);
                if (isNaN(decimalValue)) {
                    progDisplayValue = '0';
                }
                display.textContent = progDisplayValue;
            } catch (e) {
                progDisplayValue = '0';
                display.textContent = '0';
            }
            
            if (progDisplayValue.length > 15) {
                display.style.fontSize = `${Math.max(1.2, 2 - (progDisplayValue.length - 15) * 0.1)}rem`;
            } else {
                display.style.fontSize = '2rem';
            }
        }
        
        function clearProgDisplay() {
            progDisplayValue = '0';
            progFirstOperand = null;
            progOperator = null;
            progWaitingForSecondOperand = false;
            updateProgDisplay();
        }
        
        function backspaceProg() {
            if (progDisplayValue.length > 1) {
                progDisplayValue = progDisplayValue.slice(0, -1);
            } else {
                progDisplayValue = '0';
            }
            updateProgDisplay();
        }
        
        function setNumberSystem(base) {
            if (base >= 2 && base <= 36) {
                currentNumberSystem = base;
                document.getElementById('number-system-input').value = base;
                // Конвертируем текущее значение в новую систему
                try {
                    const decimalValue = parseInt(progDisplayValue, currentNumberSystem);
                    if (!isNaN(decimalValue)) {
                        progDisplayValue = decimalValue.toString(currentNumberSystem).toUpperCase();
                        updateProgDisplay();
                    }
                } catch (e) {
                    progDisplayValue = '0';
                    updateProgDisplay();
                }
            }
        }
        
        function appendToProgDisplay(value) {
            // Проверяем, допустим ли символ для текущей системы счисления
            const validChars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ'.slice(0, currentNumberSystem);
            
            if (!validChars.includes(value.toUpperCase())) {
                return; // Недопустимый символ
            }
            
            if (progDisplayValue === '0' || progWaitingForSecondOperand) {
                progDisplayValue = value;
                progWaitingForSecondOperand = false;
            } else {
                progDisplayValue += value;
            }
            updateProgDisplay();
        }
        
        function handleProgOperator(op) {
            try {
                const currentValue = parseInt(progDisplayValue, currentNumberSystem);
                
                if (progFirstOperand === null) {
                    progFirstOperand = currentValue;
                } else if (progOperator && !progWaitingForSecondOperand) {
                    const result = performProgCalculation(currentValue);
                    progDisplayValue = result.toString(currentNumberSystem).toUpperCase();
                    progFirstOperand = result;
                }
                
                progWaitingForSecondOperand = true;
                progOperator = op;
                updateProgDisplay();
            } catch (e) {
                progDisplayValue = 'Ошибка';
                updateProgDisplay();
            }
        }
        
        function performProgCalculation(secondOperand) {
            if (progOperator === '+') return progFirstOperand + secondOperand;
            if (progOperator === '-') return progFirstOperand - secondOperand;
            if (progOperator === '*') return progFirstOperand * secondOperand;
            if (progOperator === '/') return secondOperand !== 0 ? Math.floor(progFirstOperand / secondOperand) : 0;
            if (progOperator === '&') return progFirstOperand & secondOperand;
            if (progOperator === '|') return progFirstOperand | secondOperand;
            if (progOperator === '^') return progFirstOperand ^ secondOperand;
            if (progOperator === '<<') return progFirstOperand << secondOperand;
            if (progOperator === '>>') return progFirstOperand >> secondOperand;
            if (progOperator === '~') return ~secondOperand;
            return secondOperand;
        }
        
        function calculateProg() {
            try {
                if (progOperator && !progWaitingForSecondOperand) {
                    const secondOperand = parseInt(progDisplayValue, currentNumberSystem);
                    
                    if (isNaN(secondOperand)) {
                        throw new Error('Invalid number');
                    }
                    
                    const result = performProgCalculation(secondOperand);
                    
                    // Для битовых операций с отрицательными числами
                    const finalResult = result >>> 0; // Преобразуем в беззнаковое 32-битное
                    
                    progDisplayValue = finalResult.toString(currentNumberSystem).toUpperCase();
                    progOperator = null;
                    progFirstOperand = null;
                    progWaitingForSecondOperand = false;
                    updateProgDisplay();
                }
            } catch (error) {
                console.error('Programmer calc error:', error);
                progDisplayValue = 'Ошибка';
                updateProgDisplay();
            }
        }
        
        // ============ ФУНКЦИИ ДРОБНОГО КАЛЬКУЛЯТОРА ============
        function calculateFraction() {
            const num1 = parseInt(document.getElementById('frac-num1').value) || 0;
            const den1 = parseInt(document.getElementById('frac-den1').value) || 1;
            const num2 = parseInt(document.getElementById('frac-num2').value) || 0;
            const den2 = parseInt(document.getElementById('frac-den2').value) || 1;
            const operation = document.getElementById('frac-operation').value;
            
            let resultNum, resultDen;
            
            if (den1 === 0 || den2 === 0) {
                document.getElementById('fraction-result').textContent = 'Ошибка: знаменатель не может быть 0';
                return;
            }
            
            switch(operation) {
                case '+':
                    resultNum = num1 * den2 + num2 * den1;
                    resultDen = den1 * den2;
                    break;
                case '-':
                    resultNum = num1 * den2 - num2 * den1;
                    resultDen = den1 * den2;
                    break;
                case '*':
                    resultNum = num1 * num2;
                    resultDen = den1 * den2;
                    break;
                case '/':
                    if (num2 === 0) {
                        document.getElementById('fraction-result').textContent = 'Ошибка: деление на 0';
                        return;
                    }
                    resultNum = num1 * den2;
                    resultDen = den1 * num2;
                    break;
                default:
                    resultNum = num1;
                    resultDen = den1;
            }
            
            // Сокращаем дробь
            const gcdValue = gcd(resultNum, resultDen);
            resultNum /= gcdValue;
            resultDen /= gcdValue;
            
            if (resultDen < 0) {
                resultNum = -resultNum;
                resultDen = -resultDen;
            }
            
            const result = resultDen === 1 ? 
                resultNum.toString() : 
                `${resultNum}/${resultDen}`;
            
            document.getElementById('fraction-result').textContent = 
                `Результат: ${result}`;
        }
        
        function gcd(a, b) {
            a = Math.abs(a);
            b = Math.abs(b);
            while(b) {
                const t = b;
                b = a % b;
                a = t;
            }
            return a;
        }
        
        function simplifyFraction() {
            const num = parseInt(document.getElementById('frac-num1').value) || 0;
            const den = parseInt(document.getElementById('frac-den1').value) || 1;
            
            if (den === 0) {
                document.getElementById('fraction-result').textContent = 'Ошибка: знаменатель не может быть 0';
                return;
            }
            
            const gcdValue = gcd(num, den);
            const simplifiedNum = num / gcdValue;
            const simplifiedDen = den / gcdValue;
            
            if (simplifiedDen < 0) {
                simplifiedNum = -simplifiedNum;
                simplifiedDen = -simplifiedDen;
            }
            
            const result = simplifiedDen === 1 ? 
                simplifiedNum.toString() : 
                `${simplifiedNum}/${simplifiedDen}`;
            
            document.getElementById('fraction-result').textContent = 
                `Упрощенная дробь: ${result}`;
        }
        
        function convertToDecimal() {
            const num = parseInt(document.getElementById('frac-num1').value) || 0;
            const den = parseInt(document.getElementById('frac-den1').value) || 1;
            
            if (den === 0) {
                document.getElementById('fraction-result').textContent = 'Ошибка: знаменатель не может быть 0';
                return;
            }
            
            const decimal = (num / den).toFixed(6);
            document.getElementById('fraction-result').textContent = 
                `Десятичная дробь: ${decimal.replace(/\./g, ',')}`;
        }
        
        function convertToPercentage() {
            const num = parseInt(document.getElementById('frac-num1').value) || 0;
            const den = parseInt(document.getElementById('frac-den1').value) || 1;
            
            if (den === 0) {
                document.getElementById('fraction-result').textContent = 'Ошибка: знаменатель не может быть 0';
                return;
            }
            
            const percentage = ((num / den) * 100).toFixed(2);
            document.getElementById('fraction-result').textContent = 
                `Процент: ${percentage.replace(/\./g, ',')}%`;
        }
        
        // ============ ФУНКЦИИ КОНВЕРТЕРА ============
        // Улучшенная функция для отображения больших чисел
        function formatLargeNumber(number) {
            if (number === 0) return "0";
            
            // Для очень больших чисел используем экспоненциальную запись
            if (Math.abs(number) >= 1e12 || (Math.abs(number) < 1e-6 && number !== 0)) {
                return number.toExponential(6).replace(/\./g, ',');
            }
            
            // Форматируем с разделителями тысяч
            let parts = number.toString().split('.');
            parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
            
            if (parts[1]) {
                // Ограничиваем количество знаков после запятой для больших чисел
                if (parts[0].replace(/\s/g, '').length > 6) {
                    parts[1] = parts[1].substring(0, 2);
                }
                return parts.join(',').replace(/0+$/, '').replace(/,$/, '');
            }
            
            return parts[0];
        }
        
        // Конвертер длины
        function convertLength() {
            const value = parseFloat(document.getElementById('length-input').value);
            const fromUnit = document.getElementById('length-from').value;
            const toUnit = document.getElementById('length-to').value;
            
            const toMeters = {
                'm': 1,
                'km': 1000,
                'cm': 0.01,
                'mm': 0.001,
                'mile': 1609.344,
                'yard': 0.9144,
                'foot': 0.3048,
                'inch': 0.0254
            };
            
            const valueInMeters = value * (toMeters[fromUnit] || 1);
            const result = valueInMeters / (toMeters[toUnit] || 1);
            
            const formattedResult = formatLargeNumber(result);
            document.getElementById('length-result').innerHTML = 
                `${formatLargeNumber(value)} ${fromUnit} = ${formattedResult} ${toUnit}`;
        }
        
        // Конвертер массы
        function convertMass() {
            const value = parseFloat(document.getElementById('mass-input').value);
            const fromUnit = document.getElementById('mass-from').value;
            const toUnit = document.getElementById('mass-to').value;
            
            const toKilograms = {
                'kg': 1,
                'g': 0.001,
                'mg': 0.000001,
                'ton': 1000,
                'pound': 0.45359237,
                'ounce': 0.028349523125
            };
            
            const valueInKilograms = value * (toKilograms[fromUnit] || 1);
            const result = valueInKilograms / (toKilograms[toUnit] || 1);
            
            const formattedResult = formatLargeNumber(result);
            document.getElementById('mass-result').innerHTML = 
                `${formatLargeNumber(value)} ${fromUnit} = ${formattedResult} ${toUnit}`;
        }
        
        // Конвертер температуры
        function convertTemperature() {
            const value = parseFloat(document.getElementById('temperature-input').value);
            const fromUnit = document.getElementById('temperature-from').value;
            const toUnit = document.getElementById('temperature-to').value;
            
            let result;
            
            // Конвертируем в Кельвины
            let inKelvin;
            switch(fromUnit) {
                case 'celsius':
                    inKelvin = value + 273.15;
                    break;
                case 'fahrenheit':
                    inKelvin = (value + 459.67) * 5/9;
                    break;
                case 'kelvin':
                    inKelvin = value;
                    break;
                default:
                    inKelvin = value;
            }
            
            // Конвертируем из Кельвинов в целевую систему
            switch(toUnit) {
                case 'celsius':
                    result = inKelvin - 273.15;
                    break;
                case 'fahrenheit':
                    result = inKelvin * 9/5 - 459.67;
                    break;
                case 'kelvin':
                    result = inKelvin;
                    break;
                default:
                    result = inKelvin;
            }
            
            const formattedResult = formatLargeNumber(result);
            document.getElementById('temperature-result').innerHTML = 
                `${formatLargeNumber(value)}°${fromUnit.charAt(0).toUpperCase()} = ${formattedResult}°${toUnit.charAt(0).toUpperCase()}`;
        }
        
        // Конвертер площади
        function convertArea() {
            const value = parseFloat(document.getElementById('area-input').value);
            const fromUnit = document.getElementById('area-from').value;
            const toUnit = document.getElementById('area-to').value;
            
            const toSquareMeters = {
                'm2': 1,
                'km2': 1000000,
                'ha': 10000,
                'acre': 4046.8564224,
                'sq_foot': 0.09290304
            };
            
            const valueInSquareMeters = value * (toSquareMeters[fromUnit] || 1);
            const result = valueInSquareMeters / (toSquareMeters[toUnit] || 1);
            
            const formattedResult = formatLargeNumber(result);
            document.getElementById('area-result').innerHTML = 
                `${formatLargeNumber(value)} ${fromUnit} = ${formattedResult} ${toUnit}`;
        }
        
        // Конвертер объема
        function convertVolume() {
            const value = parseFloat(document.getElementById('volume-input').value);
            const fromUnit = document.getElementById('volume-from').value;
            const toUnit = document.getElementById('volume-to').value;
            
            const toLiters = {
                'm3': 1000,
                'l': 1,
                'ml': 0.001,
                'gal': 3.785411784,
                'cu_foot': 28.316846592
            };
            
            const valueInLiters = value * (toLiters[fromUnit] || 1);
            const result = valueInLiters / (toLiters[toUnit] || 1);
            
            const formattedResult = formatLargeNumber(result);
            document.getElementById('volume-result').innerHTML = 
                `${formatLargeNumber(value)} ${fromUnit} = ${formattedResult} ${toUnit}`;
        }
        
        // Конвертер времени
        function convertTime() {
            const value = parseFloat(document.getElementById('time-input').value);
            const fromUnit = document.getElementById('time-from').value;
            const toUnit = document.getElementById('time-to').value;
            
            const toSeconds = {
                'second': 1,
                'minute': 60,
                'hour': 3600,
                'day': 86400,
                'week': 604800,
                'month': 2592000, // 30 дней
                'year': 31536000 // 365 дней
            };
            
            const valueInSeconds = value * (toSeconds[fromUnit] || 1);
            const result = valueInSeconds / (toSeconds[toUnit] || 1);
            
            const formattedResult = formatLargeNumber(result);
            document.getElementById('time-result').innerHTML = 
                `${formatLargeNumber(value)} ${fromUnit} = ${formattedResult} ${toUnit}`;
        }
        
        // Конвертер скорости
        function convertSpeed() {
            const value = parseFloat(document.getElementById('speed-input').value);
            const fromUnit = document.getElementById('speed-from').value;
            const toUnit = document.getElementById('speed-to').value;
            
            const toMps = {
                'mps': 1,
                'kmph': 0.27777777777778,
                'mph': 0.44704,
                'knot': 0.51444444444444
            };
            
            const valueInMps = value * (toMps[fromUnit] || 1);
            const result = valueInMps / (toMps[toUnit] || 1);
            
            const formattedResult = formatLargeNumber(result);
            document.getElementById('speed-result').innerHTML = 
                `${formatLargeNumber(value)} ${fromUnit} = ${formattedResult} ${toUnit}`;
        }
        
        // Конвертер данных
        function convertData() {
            const value = parseFloat(document.getElementById('data-input').value);
            const fromUnit = document.getElementById('data-from').value;
            const toUnit = document.getElementById('data-to').value;
            
            const toBytes = {
                'bit': 0.125,
                'byte': 1,
                'kb': 1024,
                'mb': 1048576,
                'gb': 1073741824,
                'tb': 1099511627776,
                'pb': 1125899906842624
            };
            
            const valueInBytes = value * (toBytes[fromUnit] || 1);
            const result = valueInBytes / (toBytes[toUnit] || 1);
            
            const formattedResult = formatLargeNumber(result);
            document.getElementById('data-result').innerHTML = 
                `${formatLargeNumber(value)} ${fromUnit} = ${formattedResult} ${toUnit}`;
        }
        
        // КОНВЕРТЕР ЭНЕРГИИ - ИСПРАВЛЕН
        function convertEnergy() {
            const value = parseFloat(document.getElementById('energy-input').value);
            const fromUnit = document.getElementById('energy-from').value;
            const toUnit = document.getElementById('energy-to').value;
            
            // Коэффициенты перевода в джоули
            const toJoules = {
                'joule': 1,
                'kj': 1000,
                'cal': 4.184,
                'food_cal': 4184,
                'kwh': 3600000
            };
            
            // Проверяем наличие всех элементов
            if (!value || !fromUnit || !toUnit) {
                document.getElementById('energy-result').innerHTML = 'Ошибка: отсутствуют данные';
                return;
            }
            
            // Проверяем существование единиц измерения
            if (!toJoules[fromUnit] || !toJoules[toUnit]) {
                document.getElementById('energy-result').innerHTML = 'Ошибка: неизвестная единица измерения';
                return;
            }
            
            // Выполняем конвертацию
            const valueInJoules = value * toJoules[fromUnit];
            const result = valueInJoules / toJoules[toUnit];
            
            // Форматируем результат
            const formattedValue = formatLargeNumber(value);
            const formattedResult = formatLargeNumber(result);
            
            // Отображаем результат
            document.getElementById('energy-result').innerHTML = 
                `${formattedValue} ${fromUnit} = ${formattedResult} ${toUnit}`;
        }
        
        // Конвертер углов
        function convertAngle() {
            const value = parseFloat(document.getElementById('angle-input').value);
            const fromUnit = document.getElementById('angle-from').value;
            const toUnit = document.getElementById('angle-to').value;
            
            const toDegrees = {
                'degree': 1,
                'radian': 180 / Math.PI,
                'grad': 0.9
            };
            
            const valueInDegrees = value * (toDegrees[fromUnit] || 1);
            const result = valueInDegrees / (toDegrees[toUnit] || 1);
            
            const formattedResult = formatLargeNumber(result);
            document.getElementById('angle-result').innerHTML = 
                `${formatLargeNumber(value)} ${fromUnit} = ${formattedResult} ${toUnit}`;
        }
        
        // Конвертер давления
        function convertPressure() {
            const value = parseFloat(document.getElementById('pressure-input').value);
            const fromUnit = document.getElementById('pressure-from').value;
            const toUnit = document.getElementById('pressure-to').value;
            
            const toPascals = {
                'pa': 1,
                'kpa': 1000,
                'bar': 100000,
                'atm': 101325,
                'psi': 6894.76
            };
            
            const valueInPascals = value * (toPascals[fromUnit] || 1);
            const result = valueInPascals / (toPascals[toUnit] || 1);
            
            const formattedResult = formatLargeNumber(result);
            document.getElementById('pressure-result').innerHTML = 
                `${formatLargeNumber(value)} ${fromUnit} = ${formattedResult} ${toUnit}`;
        }
        
        // Конвертер систем счисления
        function convertNumeral() {
            const value = document.getElementById('numeral-input').value;
            const fromSystem = parseInt(document.getElementById('numeral-from').value);
            const toSystem = parseInt(document.getElementById('numeral-to').value);
            
            try {
                // Преобразуем в десятичную систему
                const decimalValue = parseInt(value, fromSystem);
                
                if (isNaN(decimalValue)) {
                    throw new Error('Неверное число для выбранной системы');
                }
                
                // Преобразуем в целевую систему
                let result = decimalValue.toString(toSystem).toUpperCase();
                
                // Для больших чисел делаем переносы
                if (result.length > 20) {
                    result = result.match(/.{1,20}/g).join('<br>');
                }
                
                document.getElementById('numeral-result').innerHTML = 
                    `${value}<sub>${fromSystem}</sub> = ${result}<sub>${toSystem}</sub>`;
            } catch (error) {
                document.getElementById('numeral-result').innerHTML = 
                    'Ошибка: введите корректное число для выбранной системы';
            }
        }
        
        // Калькулятор скидок
        function calculateDiscount() {
            const price = parseFloat(document.getElementById('discount-price').value) || 0;
            const discount = parseFloat(document.getElementById('discount-percent').value) || 0;
            
            const discountAmount = price * (discount / 100);
            const finalPrice = price - discountAmount;
            
            document.getElementById('discount-result').innerHTML = 
                `Оригинальная цена: ${formatLargeNumber(price)}<br>
                 Скидка: ${discount}% (${formatLargeNumber(discountAmount)})<br>
                 Цена со скидкой: ${formatLargeNumber(finalPrice)}`;
        }
        
        // Калькулятор ИМТ
        function calculateBMI() {
            const height = parseFloat(document.getElementById('bmi-height').value) / 100;
            const weight = parseFloat(document.getElementById('bmi-weight').value);
            const age = parseInt(document.getElementById('bmi-age').value) || 30;
            
            if (height > 0 && weight > 0 && age > 0 && age <= 150) {
                const bmi = weight / (height * height);
                
                let category = '';
                if (bmi < 18.5) {
                    category = 'Недостаточный вес';
                } else if (bmi < 25) {
                    category = 'Нормальный вес';
                } else if (bmi < 30) {
                    category = 'Избыточный вес';
                } else {
                    category = 'Ожирение';
                }
                
                const formattedBmi = bmi.toFixed(2).replace(/\./g, ',');
                document.getElementById('bmi-result').innerHTML = 
                    `Ваш ИМТ: <strong>${formattedBmi}</strong><br>
                     Категория: ${category}<br>
                     Возраст: ${age} лет`;
            } else {
                document.getElementById('bmi-result').innerHTML = 
                    'Введите корректные значения роста, веса и возраста (1-150 лет)';
            }
        }
        
        // Обновление отображения конвертера
        function updateConverterDisplay() {
            switch(currentConverterCategory) {
                case 'length': convertLength(); break;
                case 'mass': convertMass(); break;
                case 'temperature': convertTemperature(); break;
                case 'area': convertArea(); break;
                case 'volume': convertVolume(); break;
                case 'time': convertTime(); break;
                case 'speed': convertSpeed(); break;
                case 'data': convertData(); break;
                case 'energy': convertEnergy(); break;
                case 'pressure': convertPressure(); break;
                case 'angle': convertAngle(); break;
                case 'discount': calculateDiscount(); break;
                case 'numeral': convertNumeral(); break;
                case 'bmi': calculateBMI(); break;
            }
        }
        
        // ============ ФУНКЦИИ КАЛЬКУЛЯТОРА ДАТ ============
        function calculateDate() {
            const date1 = new Date(document.getElementById('date1').value);
            const date2 = new Date(document.getElementById('date2').value);
            const operation = document.getElementById('date-operation').value;
            const days = parseInt(document.getElementById('date-days').value) || 0;
            
            if (isNaN(date1.getTime()) || isNaN(date2.getTime())) {
                document.getElementById('date-result').textContent = 'Введите корректные даты';
                return;
            }
            
            let resultText = '';
            
            if (operation === 'difference') {
                const diffTime = Math.abs(date2 - date1);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                resultText = `Разница: ${formatLargeNumber(diffDays)} дней`;
            } else if (operation === 'add') {
                const newDate = new Date(date1);
                newDate.setDate(newDate.getDate() + days);
                resultText = `Новая дата: ${newDate.toLocaleDateString('ru-RU')}`;
            } else if (operation === 'subtract') {
                const newDate = new Date(date1);
                newDate.setDate(newDate.getDate() - days);
                resultText = `Новая дата: ${newDate.toLocaleDateString('ru-RU')}`;
            } else if (operation === 'dayofweek') {
                const daysOfWeek = ['Воскресенье', 'Понедельник', 'Вторник', 'Среда', 'Четверг', 'Пятница', 'Суббота'];
                const dayOfWeek = daysOfWeek[date1.getDay()];
                resultText = `День недели: ${dayOfWeek}`;
            }
            
            document.getElementById('date-result').innerHTML = resultText;
        }
        
        // ============ ФУНКЦИИ ПОСТРОИТЕЛЯ ГРАФИКОВ ============
        function plotGraph() {
            const functionText = document.getElementById('graph-function').value;
            const minX = parseFloat(document.getElementById('graph-min').value);
            const maxX = parseFloat(document.getElementById('graph-max').value);
            
            const canvas = document.getElementById('graph-canvas');
            const container = document.getElementById('graph-container');
            
            if (!functionText) {
                container.innerHTML = '<p>Введите функцию для построения графика</p>';
                return;
            }
            
            if (minX >= maxX) {
                container.innerHTML = '<p>Минимальное значение X должно быть меньше максимального</p>';
                return;
            }
            
            try {
                canvas.style.display = 'block';
                const ctx = canvas.getContext('2d');
                
                // Очищаем канвас
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Рисуем оси
                ctx.beginPath();
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                
                // Ось Y (вертикальная)
                ctx.moveTo(50, 10);
                ctx.lineTo(50, 190);
                
                // Ось X (горизонтальная)
                ctx.moveTo(10, 100);
                ctx.lineTo(390, 100);
                
                // Стрелки
                ctx.moveTo(45, 15);
                ctx.lineTo(50, 10);
                ctx.lineTo(55, 15);
                
                ctx.moveTo(385, 95);
                ctx.lineTo(390, 100);
                ctx.lineTo(385, 105);
                
                ctx.stroke();
                
                // Подписи осей
                ctx.fillStyle = '#fff';
                ctx.font = '12px Arial';
                ctx.fillText('y', 55, 20);
                ctx.fillText('x', 380, 95);
                
                // Вычисляем и рисуем график
                ctx.beginPath();
                ctx.strokeStyle = '#00dbde';
                ctx.lineWidth = 3;
                
                let firstPoint = true;
                const step = (maxX - minX) / 400;
                
                for (let i = 0; i <= 400; i++) {
                    const x = minX + i * step;
                    
                    try {
                        // Заменяем x в функции
                        let expression = functionText
                            .replace(/x/g, `(${x})`)
                            .replace(/\^/g, '**')
                            .replace(/sin\(/g, 'Math.sin(')
                            .replace(/cos\(/g, 'Math.cos(')
                            .replace(/tan\(/g, 'Math.tan(')
                            .replace(/sqrt\(/g, 'Math.sqrt(')
                            .replace(/log\(/g, 'Math.log10(')
                            .replace(/ln\(/g, 'Math.log(')
                            .replace(/pi/g, 'Math.PI');
                        
                        const y = eval(expression);
                        
                        if (isFinite(y)) {
                            const canvasX = 50 + (i * 0.85);
                            const canvasY = 100 - (y * 40); // Масштабируем
                            
                            if (firstPoint) {
                                ctx.moveTo(canvasX, canvasY);
                                firstPoint = false;
                            } else {
                                ctx.lineTo(canvasX, canvasY);
                            }
                        }
                    } catch (e) {
                        continue;
                    }
                }
                
                ctx.stroke();
                
                // Добавляем информацию о функции
                container.innerHTML = '';
                container.appendChild(canvas);
                
                const infoDiv = document.createElement('div');
                infoDiv.style.textAlign = 'center';
                infoDiv.style.marginTop = '10px';
                infoDiv.style.color = '#64b5f6';
                infoDiv.innerHTML = `График функции: y = ${functionText}<br>Диапазон X: [${minX}, ${maxX}]`;
                container.appendChild(infoDiv);
                
            } catch (error) {
                container.innerHTML = '<p style="color: #f44336;">Ошибка при построении графика. Проверьте функцию.</p>';
                canvas.style.display = 'none';
            }
        }
        
        // Инициализация
        updateDisplay();
        updateEngDisplay();
        updateProgDisplay();
    </script>
</body>
</html>